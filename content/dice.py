from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from config import r, bot


async def select_casino(message):
    try:
        uid = message.from_user.id
        mid = message.message_id

        markup = InlineKeyboardMarkup()
        markup.add(InlineKeyboardButton(text='üéØ', callback_data='selected_dice_1'),
                   InlineKeyboardButton(text='üé≤', callback_data='selected_dice_2'),
                   InlineKeyboardButton(text='üé≥', callback_data='selected_dice_3'))
        markup.add(InlineKeyboardButton(text='‚öΩ', callback_data='selected_dice_4'),
                   InlineKeyboardButton(text='üèÄ', callback_data='selected_dice_5'),
                   InlineKeyboardButton(text='üé∞', callback_data='selected_dice_6'))
        msg = 'üåù –í—ñ—Ç–∞—î–º–æ –≤–∞—Å —É RandomUAbotCasino!\n\n' \
              '–¶—ñ–Ω–∏ –∑–∞ —É—á–∞—Å—Ç—å —Ç–∞ —Å—É–º–∏ –≤–∏–≥—Ä–∞—à—É:\n' \
              'üéØ - üíµ 10 -> 50\n' \
              'üé≤ - üíµ 30 -> 150\n' \
              'üé≥ - üíµ 50 -> 250\n' \
              '‚öΩ - üíµ 100 -> 150\n' \
              'üèÄ - üíµ 100 -> 200 \n' \
              'üé∞ - üíµ 25 -> 777 / üì¶ / üåÄ / üåü'
        await bot.send_message(uid, msg, reply_to_message_id=mid, reply_markup=markup)

        if message.chat.type != 'private':
            await message.reply('–ù–∞–¥—ñ—Å–ª–∞–Ω–æ –≤ –ø–ø.')
    except:
        pass


async def dice(message):
    try:
        uid = message.from_user.id
        mid = message.message_id
        cid = message.chat.id
        selected_dice = r.hget(uid, 'selected_dice')
        money = int(r.hget(uid, 'money'))
        if selected_dice:
            selected_dice = selected_dice.decode()

            if selected_dice == 'üéØ':
                if money >= 10:
                    d = await bot.send_dice(cid, reply_to_message_id=mid, emoji=selected_dice)
                    value = d.dice.value
                    if value == 6:
                        r.hincrby(uid, 'money', 40)
                    else:
                        r.hincrby(uid, 'money', -10)
                else:
                    await message.reply('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –Ω–∞ —Ä–∞—Ö—É–Ω–∫—É.')

            elif selected_dice == 'üé≤':
                text = message.text.split()
                if len(text) == 1 or int(text[1]) not in range(1, 7):
                    await message.reply('–í–∏–±–µ—Ä—ñ—Ç—å —á–∏—Å–ª–æ –≤—ñ–¥ 1 –¥–æ 6')
                else:
                    if money >= 30:
                        d = await bot.send_dice(cid, reply_to_message_id=mid, emoji=selected_dice)
                        value = d.dice.value
                        if value == int(text[1]):
                            r.hincrby(uid, 'money', 120)
                        else:
                            r.hincrby(uid, 'money', -30)
                    else:
                        await message.reply('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –Ω–∞ —Ä–∞—Ö—É–Ω–∫—É.')

            elif selected_dice == 'üé≥':
                if money >= 50:
                    d = await bot.send_dice(cid, reply_to_message_id=mid, emoji=selected_dice)
                    value = d.dice.value
                    if value == 6:
                        r.hincrby(uid, 'money', 200)
                    else:
                        r.hincrby(uid, 'money', -50)
                else:
                    await message.reply('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –Ω–∞ —Ä–∞—Ö—É–Ω–∫—É.')

            elif selected_dice == '‚öΩ':
                if money >= 100:
                    d = await bot.send_dice(cid, reply_to_message_id=mid, emoji=selected_dice)
                    value = d.dice.value
                    if value >= 3:
                        r.hincrby(uid, 'money', 50)
                    else:
                        r.hincrby(uid, 'money', -100)
                else:
                    await message.reply('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –Ω–∞ —Ä–∞—Ö—É–Ω–∫—É.')

            elif selected_dice == 'üèÄ':
                if money >= 50:
                    d = await bot.send_dice(cid, reply_to_message_id=mid, emoji=selected_dice)
                    value = d.dice.value
                    if value >= 4:
                        r.hincrby(uid, 'money', 100)
                    else:
                        r.hincrby(uid, 'money', -100)
                else:
                    await message.reply('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –Ω–∞ —Ä–∞—Ö—É–Ω–∫—É.')

            elif selected_dice == 'üé∞':
                if money >= 25:
                    d = await bot.send_dice(cid, reply_to_message_id=mid, emoji=selected_dice)
                    value = d.dice.value
                    if value == 1:
                        r.hincrby(uid, 'packs', 1)
                    elif value == 22:
                        r.hincrby(uid, 'tape', 1)
                    elif value == 43:
                        r.hincrby(uid, 'strap', 1)
                    elif value == 64:
                        r.hincrby(uid, 'money', 777)
                    r.hincrby(uid, 'money', -25)
                else:
                    await message.reply('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –Ω–∞ —Ä–∞—Ö—É–Ω–∫—É.')

        else:
            await message.reply('/casino - –≤–∏–±—Ä–∞—Ç–∏ –≥—Ä—É')
    except:
        pass


async def callback_dice(call):
    uid = call.from_user.id
    cdata = call.data
    msg = '123'
    if cdata == 'selected_dice_1':
        r.hset(uid, 'selected_dice', 'üéØ')
        msg = '–í–∏–±—Ä–∞–Ω–æ –¥–∞—Ä—Ç—Å'
    if cdata == 'selected_dice_2':
        r.hset(uid, 'selected_dice', 'üé≤')
        msg = '–í–∏–±—Ä–∞–Ω–æ –∫—É–±–∏–∫'
    if cdata == 'selected_dice_3':
        r.hset(uid, 'selected_dice', 'üé≥')
        msg = '–í–∏–±—Ä–∞–Ω–æ –±—É–ª—ñ–Ω–≥'
    if cdata == 'selected_dice_4':
        r.hset(uid, 'selected_dice', '‚öΩ')
        msg = '–í–∏–±—Ä–∞–Ω–æ –ì–û–û–û–û–û–õ'
    if cdata == 'selected_dice_5':
        r.hset(uid, 'selected_dice', 'üèÄ')
        msg = '–í–∏–±—Ä–∞–Ω–æ –±–∞—Å–∫–µ—Ç–±–æ–ª'
    if cdata == 'selected_dice_6':
        r.hset(uid, 'selected_dice', 'üé∞')
        msg = '–í–∏–±—Ä–∞–Ω–æ —Å–ª–æ—Ç–∏'
    await bot.answer_callback_query(callback_query_id=call.id, show_alert=True, text=msg)
